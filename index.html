<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BxQuiz</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; }
    .section { display: none; }
    .active { display: block; }
    .card { transition: all 0.3s; }
    .card:hover { transform: translateY(-5px); }
    .confetti { position: absolute; width: 10px; height: 10px; animation: fall 3s linear forwards; }
    @keyframes fall {
      to { transform: translateY(800px) rotate(720deg); opacity: 0; }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 to-purple-900 text-white min-h-screen">

<div class="max-w-2xl mx-auto p-6">

  <!-- LOGIN -->
  <div id="login" class="section active">
    <div class="text-center py-20">
      <h1 class="text-5xl font-bold mb-8">BxQuiz</h1>
      <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-10">
        <input id="email" type="email" placeholder="Email" class="w-full p-4 rounded-2xl mb-4 bg-white/20 placeholder-white/70 text-white focus:outline-none focus:ring-2 focus:ring-white">
        <input id="password" type="password" placeholder="ContraseÃ±a" class="w-full p-4 rounded-2xl mb-6 bg-white/20 placeholder-white/70 text-white focus:outline-none focus:ring-2 focus:ring-white">
        <button onclick="login()" class="w-full py-4 bg-white text-indigo-900 rounded-2xl font-bold text-lg mb-3">Iniciar SesiÃ³n</button>
        <button onclick="register()" class="w-full py-4 bg-transparent border-2 border-white rounded-2xl font-bold text-lg">Registrarse</button>
        <p id="loginError" class="text-red-400 mt-4 text-center"></p>
      </div>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="section">
    <div class="text-center py-8">
      <h1 class="text-4xl font-bold">Bienvenido, <span id="userName" class="text-yellow-300"></span></h1>
      <div class="grid grid-cols-2 gap-4 mt-12">
        <button onclick="showCreate()" class="bg-white text-indigo-900 py-8 rounded-3xl font-bold text-xl card">Crear Quiz</button>
        <button onclick="showJoin()" class="bg-white text-indigo-900 py-8 rounded-3xl font-bold text-xl card">Unirse a Quiz</button>
        <button onclick="showShop()" class="bg-white text-indigo-900 py-8 rounded-3xl font-bold text-xl card">Tienda</button>
        <button onclick="showAvatars()" class="bg-white text-indigo-900 py-8 rounded-3xl font-bold text-xl card">Avatares</button>
      </div>
      <button onclick="logout()" class="mt-10 text-white/70 hover:text-white">Cerrar sesiÃ³n</button>
    </div>
  </div>

  <!-- CREAR QUIZ -->
  <div id="create" class="section">
    <h2 class="text-3xl font-bold text-center mb-8">Crear Nuevo Quiz</h2>
    <input id="quizTitle" placeholder="TÃ­tulo del quiz" class="w-full p-5 rounded-2xl bg-white/10 text-white placeholder-white/60 mb-6">
    <div id="questionsList"></div>
    <button onclick="addQuestion()" class="w-full py-4 bg-white/20 rounded-2xl mb-4">+ AÃ±adir Pregunta</button>
    <button onclick="saveQuiz()" class="w-full py-5 bg-green-500 rounded-3xl font-bold text-xl">Guardar y Generar CÃ³digo</button>
  </div>

  <!-- LOBBY -->
  <div id="lobby" class="section">
    <h2 class="text-3xl font-bold text-center mb-4">Lobby - CÃ³digo: <span id="lobbyCode" class="text-yellow-300"></span></h2>
    <div id="lobbyPlayers" class="space-y-3"></div>
    <button id="startBtn" onclick="startGame()" class="hidden w-full py-6 bg-green-500 rounded-3xl font-bold text-2xl mt-8">EMPEZAR QUIZ</button>
  </div>

  <!-- JUEGO -->
  <div id="play" class="section">
    <div class="text-center">
      <p class="text-2xl font-bold mb-2">Pregunta <span id="qNumber"></span></p>
      <h3 id="questionText" class="text-2xl mb-10 min-h-[80px]"></h3>
      <div id="options" class="space-y-4"></div>
      <p id="timer" class="text-4xl font-bold mt-10 text-yellow-300">20</p>
    </div>
  </div>

  <!-- RESULTADOS + RULETA -->
  <div id="results" class="section">
    <h2 class="text-4xl font-bold text-center mb-8">Â¡Quiz Terminado!</h2>
    <div class="bg-white/10 rounded-3xl p-10 text-center">
      <p class="text-2xl">Aciertos: <span id="finalCorrect" class="text-green-400"></span></p>
      <p class="text-2xl mt-4">Fallos: <span id="finalWrong" class="text-red-400"></span></p>
      <p class="text-4xl font-bold mt-8 text-yellow-300">Monedas ganadas: <span id="finalCoins"></span></p>
    </div>
    <button onclick="showRoulette()" class="w-full py-6 bg-yellow-400 text-black rounded-3xl font-bold text-2xl mt-10">Girar Ruleta (cada 5 horas)</button>
  </div>

  <!-- RULETA -->
  <div id="rouletteScreen" class="section hidden">
    <h2 class="text-3xl font-bold text-center mb-8">Ruleta Diaria</h2>
    <div class="flex justify-center">
      <div id="wheel" class="w-80 h-80 border-8 border-yellow-400 rounded-full relative">
        <div id="pointer" class="absolute -top-4 left-1/2 -translate-x-1/2 text-6xl">â–¼</div>
      </div>
    </div>
    <button onclick="spinWheel()" class="mt-10 w-full py-6 bg-yellow-400 text-black rounded-3xl font-bold text-2xl">Â¡GIRAR!</button>
  </div>

  <!-- TIENDA -->
  <div id="shop" class="section">
    <h2 class="text-3xl font-bold text-center mb-8">Tienda</h2>
    <div class="grid grid-cols-2 gap-6">
      <div onclick="buyPack(1)" class="bg-white/10 rounded-3xl p-8 text-center cursor-pointer hover:bg-white/20 transition">
        <p class="text-2xl">Sobre BÃ¡sico</p>
        <p class="text-5xl font-bold text-yellow-300">10 ðŸ’°</p>
      </div>
    </div>
  </div>

  <!-- AVATARES -->
  <div id="avatars" class="section">
    <h2 class="text-3xl font-bold text-center mb-8">Elige tu Avatar</h2>
    <div id="avatarGrid" class="grid grid-cols-4 gap-4"></div>
  </div>
</div>

<script>
// ==================== FIREBASE CONFIG ====================
const firebaseConfig = {
  apiKey: "AIzaSyD13N4-9MjTrmlPwGP7mves0Exje4v2ACw",
  authDomain: "kahoot-8529e.firebaseapp.com",
  databaseURL: "https://kahoot-8529e-default-rtdb.firebaseio.com",
  projectId: "kahoot-8529e",
  storageBucket: "kahoot-8529e.firebasestorage.app",
  messagingSenderId: "313414356056",
  appId: "1:313414356056:web:4aab4587f7df9393008e2d"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// ==================== VARIABLES GLOBALES ====================
let currentUser = null;
let currentGameCode = null;
let currentGameRef = null;
let selectedAvatar = "ðŸ‘¤";

// ==================== NAVEGACIÃ“N ====================
function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

// ==================== AUTH ====================
function login() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  auth.signInWithEmailAndPassword(email, password)
    .then(user => {
      currentUser = user.user;
      showDashboard();
    })
    .catch(err => alert(err.message));
}

function register() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  auth.createUserWithEmailAndPassword(email, password)
    .then(user => {
      currentUser = user.user;
      showDashboard();
    })
    .catch(err => alert(err.message));
}

function logout() {
  auth.signOut();
  showSection('login');
}

// ==================== DASHBOARD ====================
function showDashboard() {
  document.getElementById('userName').textContent = currentUser.email.split('@')[0];
  showSection('dashboard');
}

// ==================== CREAR QUIZ ====================
let questions = [];

function addQuestion() {
  questions.push({ question: '', options: ['', '', '', ''], correct: 0 });
  renderQuestions();
}

function renderQuestions() {
  const container = document.getElementById('questionsList');
  container.innerHTML = '';
  questions.forEach((q, i) => {
    const div = document.createElement('div');
    div.className = "bg-white/10 rounded-2xl p-6 mb-6";
    div.innerHTML = `
      <input value="${q.question}" placeholder="Pregunta" class="w-full p-4 bg-white/20 rounded-xl mb-4" onchange="questions[${i}].question = this.value">
      <div class="grid grid-cols-2 gap-3">
        ${q.options.map((opt, j) => `
          <div class="flex items-center">
            <input type="radio" name="correct${i}" ${q.correct === j ? 'checked' : ''} onchange="questions[${i}].correct = ${j}">
            <input value="${opt}" placeholder="OpciÃ³n ${j+1}" class="flex-1 p-3 bg-white/20 rounded-xl ml-3" onchange="questions[${i}].options[${j}] = this.value">
          </div>
        `).join('')}
      </div>
    `;
    container.appendChild(div);
  });
}

function saveQuiz() {
  if (!questions.length) return alert("AÃ±ade al menos una pregunta");
  const title = document.getElementById('quizTitle').value || "Sin tÃ­tulo";
  const gameCode = Math.random().toString(36).substring(2, 8).toUpperCase();

  db.ref(`games/${gameCode}`).set({
    title,
    creator: currentUser.uid,
    questions,
    currentQuestion: -1,
    started: false,
    players: {}
  });

  currentGameCode = gameCode;
  showLobby(gameCode);
}

// ==================== LOBBY ====================
function showLobby(code) {
  currentGameCode = code;
  showSection('lobby');
  document.getElementById('lobbyCode').textContent = code;

  const playersRef = db.ref(`games/${code}/players`);
  playersRef.on('value', snap => {
    const list = document.getElementById('lobbyPlayers');
    list.innerHTML = '';
    snap.forEach(child => {
      const p = child.val();
      const div = document.createElement('div');
      div.className = "player bg-white/10 rounded-2xl p-4";
      div.textContent = p.email || "Jugador";
      list.appendChild(div);
    });
  });

  // Solo el creador ve el botÃ³n Start
  if (currentUser.uid === /* creator uid */) {
    document.getElementById('startBtn').classList.remove('hidden');
  }
}

function startGame() {
  db.ref(`games/${currentGameCode}`).update({ started: true, currentQuestion: 0 });
}

// ==================== JUEGO ====================
function showPlay() {
  showSection('play');
  // AquÃ­ irÃ­a la lÃ³gica completa del juego (preguntas, timer, etc.)
  // Por brevedad, lo dejo simplificado. Puedes expandirlo despuÃ©s.
}

// ==================== RULETA ====================
function showRoulette() {
  showSection('rouletteScreen');
}

function spinWheel() {
  const prizes = [0,0,0,0,0,0,0,0,0,0,500,2000];
  const result = prizes[Math.floor(Math.random() * prizes.length)];
  alert(`Â¡Ganaste ${result} monedas!`);
}

// ==================== TIENDA Y AVATARES ====================
function showShop() {
  showSection('shop');
}

function showAvatars() {
  showSection('avatars');
  const grid = document.getElementById('avatarGrid');
  grid.innerHTML = 'ðŸ‘¨â€ðŸš€ ðŸ‘©â€ðŸš€ ðŸ§™â€â™‚ï¸ ðŸ§™â€â™€ï¸ ðŸ¦¸â€â™‚ï¸ ðŸ¦¸â€â™€ï¸ ðŸ¼ ðŸ¶ ðŸ± ðŸ¦ ðŸ» ðŸ¸'.split(' ').map(emoji => 
    `<div onclick="selectAvatar('${emoji}')" class="text-6xl cursor-pointer hover:scale-125 transition">${emoji}</div>`
  ).join('');
}

function selectAvatar(emoji) {
  selectedAvatar = emoji;
  alert(`Avatar seleccionado: ${emoji}`);
}

// Inicializar
auth.onAuthStateChanged(user => {
  if (user) {
    currentUser = user;
    showDashboard();
  } else {
    showSection('login');
  }
});
</script>
</body>
</html>
