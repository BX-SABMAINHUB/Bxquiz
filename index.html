<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BxQuiz - Kahoot Profesional</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
    
    body { font-family: 'Poppins', sans-serif; }
    .section { display: none; }
    .active { display: block; }
    .glass { background: rgba(255,255,255,0.1); backdrop-filter: blur(12px); }
    .card { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
    .card:hover { transform: translateY(-8px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
    .confetti { position: absolute; width: 10px; height: 10px; border-radius: 50%; animation: fall 3s linear forwards; }
    @keyframes fall { to { transform: translateY(800px) rotate(720deg); opacity: 0; } }
    .pack { transition: transform 0.6s; }
    .pack.open { transform: scale(1.6) rotate(15deg); }
    .roulette { transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1); }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 text-white min-h-screen">

<div class="max-w-4xl mx-auto p-6">

  <!-- LOGIN -->
  <div id="login" class="section active">
    <div class="glass rounded-3xl p-12 text-center max-w-md mx-auto mt-20">
      <h1 class="text-5xl font-bold mb-8">BxQuiz</h1>
      <input id="email" type="email" placeholder="Email" class="w-full px-6 py-4 rounded-2xl bg-white/10 border border-white/20 focus:outline-none focus:border-white mb-4 text-lg" />
      <input id="password" type="password" placeholder="Contrase帽a" class="w-full px-6 py-4 rounded-2xl bg-white/10 border border-white/20 focus:outline-none focus:border-white mb-8 text-lg" />
      
      <button onclick="login()" class="w-full py-4 bg-white text-indigo-900 font-semibold rounded-2xl text-xl mb-3 hover:bg-white/90 transition">Iniciar Sesi贸n</button>
      <button onclick="register()" class="w-full py-4 bg-transparent border-2 border-white font-semibold rounded-2xl text-xl hover:bg-white/10 transition">Registrarse</button>
      
      <p id="loginError" class="text-red-400 mt-6 font-medium"></p>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="section">
    <div class="flex justify-between items-center mb-12">
      <h1 class="text-4xl font-bold">BxQuiz</h1>
      <div class="flex items-center gap-4">
        <div id="userInfo" class="text-right"></div>
        <button onclick="logout()" class="px-6 py-3 bg-red-500 hover:bg-red-600 rounded-2xl">Salir</button>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-6">
      <button onclick="showCreateQuiz()" class="card bg-white/10 hover:bg-white/20 p-10 rounded-3xl text-left">
        <h2 class="text-3xl font-semibold">Crear Quiz</h2>
        <p class="text-white/70 mt-4">Crea tu propio quiz y comparte el c贸digo</p>
      </button>
      <button onclick="showJoinQuiz()" class="card bg-white/10 hover:bg-white/20 p-10 rounded-3xl text-left">
        <h2 class="text-3xl font-semibold">Unirse a Quiz</h2>
        <p class="text-white/70 mt-4">Ingresa un c贸digo o escanea QR</p>
      </button>
    </div>

    <div class="mt-12">
      <h2 class="text-2xl font-semibold mb-6">Tienda de Sobres</h2>
      <div class="grid grid-cols-3 gap-6">
        <div onclick="buyPack(1)" class="card bg-gradient-to-br from-amber-400 to-orange-500 p-8 rounded-3xl cursor-pointer text-center">
          <h3 class="text-2xl font-bold">Sobre B谩sico</h3>
          <p class="text-4xl my-4">10 </p>
          <p class="text-sm">1 avatar aleatorio</p>
        </div>
        <!-- M谩s sobres se pueden a帽adir f谩cilmente -->
      </div>
    </div>
  </div>

  <!-- CREAR QUIZ -->
  <div id="createQuiz" class="section">
    <h2 class="text-3xl font-bold mb-8 text-center">Crear Nuevo Quiz</h2>
    <input id="quizTitle" placeholder="T铆tulo del quiz" class="w-full px-8 py-5 rounded-3xl bg-white/10 text-xl mb-8" />
    
    <div id="questionsList" class="space-y-8"></div>
    
    <div class="flex gap-4 mt-10">
      <button onclick="addNewQuestion()" class="flex-1 py-5 bg-purple-600 hover:bg-purple-700 rounded-3xl text-xl font-medium">+ A帽adir Pregunta</button>
      <button onclick="saveAndGenerateQuiz()" class="flex-1 py-5 bg-green-600 hover:bg-green-700 rounded-3xl text-xl font-medium">Guardar y Generar C贸digo</button>
    </div>
  </div>

  <!-- LOBBY -->
  <div id="lobby" class="section">
    <h2 class="text-4xl font-bold text-center mb-4">Lobby - C贸digo: <span id="lobbyCode" class="text-yellow-400"></span></h2>
    <div class="text-center text-white/70 mb-8">Esperando al creador...</div>
    
    <div id="lobbyPlayers" class="grid grid-cols-2 gap-4"></div>
    
    <div id="startButtonContainer" class="hidden text-center mt-12">
      <button onclick="startGame()" class="px-16 py-6 bg-green-500 hover:bg-green-600 text-2xl font-bold rounded-3xl">EMPEZAR QUIZ</button>
    </div>
  </div>

  <!-- JUEGO -->
  <div id="game" class="section">
    <div class="flex justify-between items-center mb-8">
      <h3 id="questionNumber" class="text-2xl font-medium"></h3>
      <div class="w-48 h-3 bg-white/20 rounded-full overflow-hidden">
        <div id="timerBar" class="h-full bg-yellow-400 w-full transition-all"></div>
      </div>
    </div>
    
    <h2 id="currentQuestion" class="text-3xl font-semibold text-center mb-12 min-h-[80px]"></h2>
    
    <div id="options" class="grid grid-cols-2 gap-6"></div>
    
    <div id="gameFeedback" class="text-center mt-12 text-3xl font-bold min-h-[60px]"></div>
  </div>

  <!-- RULETA -->
  <div id="rouletteScreen" class="section hidden">
    <h2 class="text-4xl font-bold text-center mb-12">Ruleta Diaria</h2>
    <div class="relative w-80 h-80 mx-auto">
      <div id="rouletteWheel" class="roulette w-80 h-80 rounded-full border-8 border-white shadow-2xl overflow-hidden relative">
        <!-- Se rellena con JS -->
      </div>
      <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 bg-white rounded-full shadow-xl flex items-center justify-center text-3xl z-10">
        
      </div>
    </div>
    <button onclick="spinRoulette()" id="spinBtn" class="mt-12 mx-auto block px-16 py-6 bg-gradient-to-r from-yellow-400 to-orange-500 text-2xl font-bold rounded-3xl">GIRAR RULETA</button>
  </div>

</div>

<script>
// ==================== FIREBASE CONFIG ====================
const firebaseConfig = {
  apiKey: "AIzaSyD13N4-9MjTrmlPwGP7mves0Exje4v2ACw",
  authDomain: "kahoot-8529e.firebaseapp.com",
  databaseURL: "https://kahoot-8529e-default-rtdb.firebaseio.com",
  projectId: "kahoot-8529e",
  storageBucket: "kahoot-8529e.firebasestorage.app",
  messagingSenderId: "313414356056",
  appId: "1:313414356056:web:4aab4587f7df9393008e2d",
  measurementId: "G-8T4CPC1BQ3"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// ==================== VARIABLES GLOBALES ====================
let currentUser = null;
let currentGameCode = null;
let isCreator = false;
let currentQuestionIndex = 0;
let score = 0;
let correctCount = 0;
let wrongCount = 0;

// ==================== FUNCIONES DE NAVEGACIN ====================
function showSection(sectionId) {
  document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
  document.getElementById(sectionId).classList.remove('hidden');
}

// ==================== AUTH ====================
auth.onAuthStateChanged(user => {
  currentUser = user;
  if (user) {
    document.getElementById('userInfo').innerHTML = `
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-xl"></div>
        <div>
          <div class="font-medium">${user.email}</div>
          <div class="text-xs text-white/60">Jugador</div>
        </div>
      </div>
    `;
    showSection('dashboard');
  } else {
    showSection('login');
  }
});

function login() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  auth.signInWithEmailAndPassword(email, password).catch(err => alert(err.message));
}

function register() {
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  auth.createUserWithEmailAndPassword(email, password).catch(err => alert(err.message));
}

function logout() {
  auth.signOut();
}

// ==================== CREAR QUIZ ====================
function showCreateQuiz() {
  showSection('createQuiz');
  document.getElementById('questionsList').innerHTML = '';
  addNewQuestion();
}

function addNewQuestion() {
  const container = document.getElementById('questionsList');
  const index = container.children.length + 1;
  const div = document.createElement('div');
  div.className = "bg-white/10 p-6 rounded-3xl";
  div.innerHTML = `
    <h3 class="font-medium mb-4">Pregunta ${index}</h3>
    <input id="q${index}" placeholder="Escribe la pregunta" class="w-full px-6 py-4 bg-white/10 rounded-2xl mb-6" />
    <div class="grid grid-cols-2 gap-4">
      <div class="flex items-center gap-3"><input id="o${index}_1" placeholder="Opci贸n 1" class="flex-1 px-5 py-3 bg-white/10 rounded-2xl" /><input type="radio" name="correct${index}" value="0"></div>
      <div class="flex items-center gap-3"><input id="o${index}_2" placeholder="Opci贸n 2" class="flex-1 px-5 py-3 bg-white/10 rounded-2xl" /><input type="radio" name="correct${index}" value="1"></div>
      <div class="flex items-center gap-3"><input id="o${index}_3" placeholder="Opci贸n 3" class="flex-1 px-5 py-3 bg-white/10 rounded-2xl" /><input type="radio" name="correct${index}" value="2"></div>
      <div class="flex items-center gap-3"><input id="o${index}_4" placeholder="Opci贸n 4" class="flex-1 px-5 py-3 bg-white/10 rounded-2xl" /><input type="radio" name="correct${index}" value="3"></div>
    </div>
  `;
  container.appendChild(div);
}

function saveAndGenerateQuiz() {
  const title = document.getElementById('quizTitle').value.trim();
  if (!title) return alert("Pon un t铆tulo");

  const questions = [];
  const questionDivs = document.getElementById('questionsList').children;
  for (let div of questionDivs) {
    const q = div.querySelector('input[id^="q"]').value.trim();
    const options = [];
    let correct = 0;
    for (let i = 1; i <= 4; i++) {
      const opt = div.querySelector(`input[id$="_${i}"]`).value.trim();
      if (opt) options.push(opt);
      if (div.querySelector(`input[type="radio"][value="${i-1}"]`).checked) correct = i-1;
    }
    if (!q || options.length < 2) return alert("Completa todas las preguntas correctamente");
    questions.push({ question: q, options, correct });
  }

  const gameCode = Math.random().toString(36).substring(2, 8).toUpperCase();

  db.ref(`games/${gameCode}`).set({
    title,
    creator: currentUser.uid,
    creatorEmail: currentUser.email,
    questions,
    createdAt: Date.now(),
    players: {},
    currentQuestion: -1,
    started: false,
    ended: false
  }).then(() => {
    currentGameCode = gameCode;
    showLobby(gameCode);
  });
}

function showLobby(gameCode) {
  currentGameCode = gameCode;
  showSection('lobby');
  document.getElementById('lobbyCode').textContent = gameCode;

  // Escuchar jugadores
  db.ref(`games/${gameCode}/players`).on('value', snap => {
    const players = snap.val() || {};
    const container = document.getElementById('lobbyPlayers');
    container.innerHTML = '';
    Object.values(players).forEach(p => {
      const div = document.createElement('div');
      div.className = "bg-white/10 p-6 rounded-3xl text-center";
      div.innerHTML = `<div class="text-2xl mb-2"></div><div>${p.email}</div>`;
      container.appendChild(div);
    });
  });

  // Mostrar bot贸n Start si soy el creador
  if (currentUser.uid === game.creator) {
    document.getElementById('startButtonContainer').classList.remove('hidden');
  }
}

function startGame() {
  db.ref(`games/${currentGameCode}`).update({ started: true, currentQuestion: 0 });
}

// ==================== JOIN QUIZ ====================
function showJoinQuiz() {
  showSection('joinQuiz'); // Puedes a帽adir una secci贸n de join si quieres, o usar directamente el input del c贸digo
  // Para simplificar, puedes a帽adir un input en dashboard o crear una secci贸n
}

// ==================== RULETA ====================
function showRoulette() {
  showSection('rouletteScreen');
}

// ==================== TIENDA ====================
function buyPack(price) {
  // L贸gica de compra de sobres con animaci贸n
  alert("Animaci贸n de sobre abri茅ndose (en versi贸n completa)");
}

// ==================== INICIALIZACIN ====================
window.onload = () => {
  // Firebase ya inicializado arriba
};
</script>
</body>
</html>
